<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>你在哪里？</title>
</head>
<link  rel="stylesheet" href="/static/lib/layui/css/layui.css"/>
<link  rel="stylesheet" href="/static/lib/layui/css/layui.mobile.css"/>
<script type="text/javascript" src="http://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript" src="/static/lib/layui/layui.all.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=63eSOd6tb5WYVgfhOo8aLjM7HtHoQgUw"></script>
<style type="text/css">
    #allmap {width: 650px;height:650px;overflow: hidden;margin:0;font-family:"微软雅黑";}
</style>
<body>
<div class="layui-container">
    <div class="layui-row">
        <div class="layui-col-xs4 layui-col-xs-offset4" >
            <div id="baidu_geo" class="layui-btn layui-btn-normal">亲爱的？你在哪里？</div>
        </div>
        <div id="allmap"></div>
    </div>
</div>
<script type="text/javascript">
    // 百度地图API功能
    var map = new BMap.Map("allmap");
    var point = new BMap.Point(116.331398, 39.897445);

    map.centerAndZoom(point, 11);
    $('#baidu_geo').click(function () {
        var geolocation = new BMap.Geolocation();
        geolocation.getCurrentPosition(function(r){
            if(this.getStatus() == BMAP_STATUS_SUCCESS){
                var point = new BMap.Point(r.point.lng,r.point.lat); //这里设置刚开始的点所在处
                var gc = new BMap.Geocoder();  //初始化，Geocoder类
                gc.getLocation(point, function (rs) {   //getLocation函数用来解析地址信息，分别返回省市区街等
                    var addComp = rs.addressComponents;
                    province = addComp.province;//获取省份
                    city = addComp.city;//获取城市
                    district = addComp.district;//区
                    street = addComp.street;//街

                    var marker = new BMap.Marker(point); //地图事件类
                    var opts = {
                        width: 25,     // 信息窗口宽度
                        height: 120,     // 信息窗口高度
                        title: "我所在的地点:<hr />"  // 信息窗口标题,可以嵌入html
                    }
                    var infoWindow = new BMap.InfoWindow("省份:" + province + ";" + "城市:"
                        + city + ";<br /><br />" + "县/区:" + district + ";" + "街道:" + street + ".", opts);
                    // 创建信息窗口对象，把信息在初始化 地图信息窗口类的同时写进去
                    map.centerAndZoom(point, 13); //绘制地图
                    map.addOverlay(marker); //标记地图
                    map.openInfoWindow(infoWindow, point); //开启信息窗口
                });

                    console.log(r);
            }else {
               console.log('failed'+this.getStatus());
            }
        },{enableHighAccuracy: true});
    });
</script>
</body>
</html>