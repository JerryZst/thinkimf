<script type="text/javascript" src="//api.map.baidu.com/api?v=3.0&ak={$ak}"></script>
<script type="text/javascript" src="/static/js/adddevice.js"></script>
<div class="layui-container" style="margin-top:25px;">
    <fieldset class="layui-elem-field layui-field-title">
        <legend>{$deviceid} - 设备详情 - Web版本 -  ThinkIMF</legend>
    </fieldset>
    <style>
        .opMenu button{
            margin-top:15px;
        }
    </style>
    <div class="layui-row">
        <div class="layui-col-md6">
            <div class="layui-anim layui-anim-fadein layui-anim-loop">
                <img style="width:100%;height:360px" src="/static/images/cloud/heart.png" />
            </div>
            <audio autoplay="autoplay" loop="loop">
                <source src="/static/audio/heart.wav" type="audio/wav" >
                <source src="/static/audio/heart.mp3" type="audio/mpeg">
            </audio>
            <div class="">

            </div>
        </div>
        <div class="layui-col-md6">
            <div class="opMenu">
                <button style="margin-left: 10px" class="layui-btn-fluid layui-btn layui-btn-radius layui-btn-warm">
                    <i class="layui-icon">&#xe608;</i> 添加
                </button>
                <button class="layui-btn-fluid layui-btn layui-btn-radius layui-btn-normal">默认</button>
                <button class="layui-btn-fluid layui-btn layui-btn-radius layui-btn-warm">默认</button>
                <button class="layui-btn-fluid layui-btn layui-btn-radius layui-btn-danger">默认</button>
                <button class="layui-btn-fluid layui-btn layui-btn-radius layui-btn-primary">默认</button>

            </div>
            <form class="layui-form" action="">
                <div class="layui-form-item">
                    <label class="layui-form-label">Cloud APP ID</label>
                    <div class="layui-input-block">
                        <input type="text" name="appid" lay-verify="appid" autocomplete="off" placeholder="云App Id"
                               class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">Cloud APP SECRET</label>
                    <div class="layui-input-block">
                        <input type="text" name="appsecret" lay-verify="appsecret" autocomplete="appsecret"
                               placeholder="云App Secret"
                               class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">设备设备ID</label>
                    <div class="layui-input-block">
                        <input type="text" name="deviceid" lay-verify="deviceid" autocomplete="off" placeholder="设备ID"
                               class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">设备类型</label>
                    <div class="layui-input-inline">
                        <select name="type[0]" lay-filter="type1">
                            <option>请选择</option>
                        </select>
                    </div>
                    <div class="layui-input-inline type2"  style="display:none;">
                        <select name="type[1]" lay-filter="type2" >
                            <option>请选择</option>
                        </select>
                    </div>
                    <div class="layui-input-inline type3" style="display: none;">
                        <select name="type[2]" lay-filter="type3" >
                            <option>请选择</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">假|死设备</label>
                    <div class="layui-input-block">
                        <input type="checkbox" name="fake_device"  lay-skin="switch" lay-text=" 是|否">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">数据上报</label>
                    <div class="layui-input-block">
                        <input type="checkbox" name="push_tocloud" checked lay-skin="switch" lay-text="开|关">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">Cloud 消息</label>
                    <div class="layui-input-block">
                        <input type="checkbox" checked="checked" name="is_receive" lay-skin="switch"
                               lay-filter="clientSwitch"
                               lay-text="开|关">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">设备描述</label>
                    <div class="layui-input-block">
                        <input type="text" name="desc" lay-verify="desc" autocomplete="off" placeholder="设备描述"
                               class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">技术方案</label>
                    <div class="layui-input-block">
                        <input type="radio" name="technology" value="cloud" title="☁️云模式(云端作为服务器)" checked="checked">
                        <input disabled type="radio" name="technology" value="wlan"
                               title="wlan(服务搭建在局域网中,特指本套源代码架设在局域网中)">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">IP地址</label>
                    <div class="layui-input-block">
                        <input type="text" name="ip" lay-verify="ip" autocomplete="off" placeholder="IP地址"
                               class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">地理位置</label>
                    <div class="layui-input-block">
                        <input type="text" name="location" id="suggestId" lay-verify="location" autocomplete="off" placeholder="地理位置"
                               class="layui-input">
                    </div>
                    <div id="searchResultPanel" style="border:1px solid #C0C0C0;width:150px;height:auto; display:none;"></div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">地理点</label>
                    <div class="layui-input-block">
                        <input type="text" name="mappoint" lay-verify="mappoint" autocomplete="off" placeholder="地理点"
                               class="layui-input">
                    </div>
                </div>
                <style>
                    .anchorBL{
                        display: none;
                    }
                </style>
                <div class="layui-form-item bmap layi-col-md4 layui-col-sm-offset1" id="bmap" style="width: 100%;height:450px">

                </div>

            </form>
        </div>
    </div>
</div>
<script>
    var form;
    layui.use(['form', 'layedit', 'laydate'], function () {
        form = layui.form
            , layer = layui.layer
        form.render();

        //自定义验证规则
        form.verify({
            title: function (value) {
                if (value.length < 5) {
                    return '标题至少得5个字符啊';
                }
            }
        });

        //监听指定开关
        form.on('switch(clientSwitch)', function (data) {
            layer.msg('开关checked：' + (this.checked ? 'true' : 'false'), {
                offset: '6px'
            });
            layer.tips('温馨提示：请注意开关状态的文字可以随意定义，而不仅仅是ON|OFF', data.othis)
        });

        //监听提交
        form.on('submit(client)', function (data) {
            layer.alert(JSON.stringify(data.field), {
                title: '最终的提交信息'
            })
            return false;
        });


    });
</script>
<script>
    $(function () {
        // 百度地图API功能
        var map = new BMap.Map("bmap",{mapType:BMAP_HYBRID_MAP});// 创建Map实例
        //map.setMapStyle({style: 'googlelite'}); //设置google风格模板
        map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放
        map.disableDragging();
        map.centerAndZoom(new BMap.Point(103.388611,35.563611),4);
        map.addControl(new BMap.MapTypeControl({
            mapTypes:[
                BMAP_SATELLITE_MAP,
                BMAP_HYBRID_MAP,
            ]}));
        //根据ip定位
        var myCity = new BMap.LocalCity();
        myCity.get(UserDefaultLocation);

        function G(id) {
            return document.getElementById(id);
        }
        function UserDefaultLocation(result) {
            var cityName = result.name;
            //map.setCurrentCity("北京");
            map.setCenter(cityName);
        }

        var ac = new BMap.Autocomplete(    //建立一个自动完成的对象
            {"input" : "suggestId"
                ,"location" : map
            });

        ac.addEventListener("onhighlight", function(e) {  //鼠标放在下拉列表上的事件
            var str = "";
            var _value = e.fromitem.value;
            var value = "";
            if (e.fromitem.index > -1) {
                value = _value.province +  _value.city +  _value.district +  _value.street +  _value.business;
            }
            str = "FromItem<br />index = " + e.fromitem.index + "<br />value = " + value;

            value = "";
            if (e.toitem.index > -1) {
                _value = e.toitem.value;
                value = _value.province +  _value.city +  _value.district +  _value.street +  _value.business;
            }
            str += "<br />ToItem<br />index = " + e.toitem.index + "<br />value = " + value;
            G("searchResultPanel").innerHTML = str;
        });

        var myValue;
        ac.addEventListener("onconfirm", function(e) {    //鼠标点击下拉列表后的事件
            var _value = e.item.value;
            //省市区地址
            myValue = _value.province +  _value.city +  _value.district +  _value.street +  _value.business;
            G("searchResultPanel").innerHTML ="onconfirm<br />index = " + e.item.index + "<br />myValue = " + myValue;
            $('#searchResultPanel').hide(300);

            map.clearOverlays();    //清除地图上所有覆盖物
            function myFun(){

                var pp = local.getResults().getPoi(0).point;    //获取第一个智能搜索的结果
                $('input[name="mappoint"]').val(JSON.stringify(pp));
                map.centerAndZoom(pp, 18);
                var marker = new BMap.Marker(pp);
                map.addOverlay(marker);    //添加标注
                //添加信息窗口
                var opts = {
                    width : 200,     // 信息窗口宽度
                    height: 100,     // 信息窗口高度
                    title : '<b style="color:red;">信息提示</b>' , // 信息窗口标题
                }
                var infoWindow = new BMap.InfoWindow(myValue, opts);  // 创建信息窗口对象
                map.openInfoWindow(infoWindow,pp); //开启信息窗口
                marker.addEventListener("click", function(){
                    this.openInfoWindow(infoWindow);
                });
            }
            var local = new BMap.LocalSearch(map, { //智能搜索
                onSearchComplete: myFun
            });
            local.search(myValue);
        });

    });
</script>